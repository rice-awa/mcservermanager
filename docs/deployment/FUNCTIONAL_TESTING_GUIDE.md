# åŠŸèƒ½æµ‹è¯•æŒ‡å— (æ­¥éª¤ 54-56)

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•è¿è¡Œåç«¯åŠŸèƒ½æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬è¿æ¥ã€æ§åˆ¶å°å’Œä»ªè¡¨ç›˜æµ‹è¯•ã€‚

## æ¦‚è¿°

åŠŸèƒ½æµ‹è¯•åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

- **æ­¥éª¤ 54: è¿æ¥æµ‹è¯•** - æµ‹è¯• RCONã€WebSocket å’Œæ–­çº¿é‡è¿
- **æ­¥éª¤ 55: æ§åˆ¶å°æµ‹è¯•** - æµ‹è¯•å‘½ä»¤å‘é€å’Œå“åº”
- **æ­¥éª¤ 56: ä»ªè¡¨ç›˜æµ‹è¯•** - æµ‹è¯•æ•°æ®æ›´æ–°å’ŒçŠ¶æ€æ¨é€

## å‰ç½®è¦æ±‚

### 1. åç«¯æœåŠ¡è¿è¡Œ

```bash
cd backend
npm install
npm run dev
```

ç¡®ä¿åç«¯æœåŠ¡åœ¨ http://localhost:3001 è¿è¡Œã€‚

### 2. Minecraft æœåŠ¡å™¨é…ç½®

#### å¯ç”¨ RCON

ç¼–è¾‘ Minecraft æœåŠ¡å™¨çš„ `server.properties`:

```properties
enable-rcon=true
rcon.port=25575
rcon.password=your-password-here
```

é‡å¯æœåŠ¡å™¨ã€‚

#### å®‰è£… Spark Mod (å¯é€‰ï¼Œç”¨äºä»ªè¡¨ç›˜æµ‹è¯•)

1. ä¸‹è½½ Spark: https://spark.lucko.me/download
2. å°† jar æ”¾å…¥ `mods` æˆ– `plugins` ç›®å½•
3. é‡å¯æœåŠ¡å™¨

### 3. æ·»åŠ æœåŠ¡å™¨é…ç½®

ä½¿ç”¨åç«¯ API æˆ–å‘½ä»¤è¡Œæ·»åŠ æœåŠ¡å™¨é…ç½®:

```bash
# ä½¿ç”¨ curl æ·»åŠ é…ç½® (Windows PowerShell åŠ  -UseBasicParsing å‚æ•°)
curl -X POST http://localhost:3001/api/configs `
  -H "Content-Type: application/json" `
  -d '{
    "name": "æµ‹è¯•æœåŠ¡å™¨",
    "host": "127.0.0.1",
    "port": 25575,
    "password": "your-password",
    "timeout": 5000,
    "sparkApiUrl": "http://127.0.0.1:8080"
  }' -UseBasicParsing
```

## è¿è¡Œæµ‹è¯•

### æ–¹å¼ 1: è¿è¡Œæ‰€æœ‰åŠŸèƒ½æµ‹è¯•

è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ (æ¨è):

```bash
cd backend
npm run test:functional
```

è¿™å°†æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰ä¸‰ä¸ªæµ‹è¯•å¥—ä»¶ï¼Œå¹¶æ‰“å°æ€»ä½“ç»“æœã€‚

### æ–¹å¼ 2: è¿è¡Œå•ä¸ªæµ‹è¯•

#### è¿è¡Œè¿æ¥æµ‹è¯• (æ­¥éª¤ 54)

```bash
cd backend
npx ts-node test/test-connection.ts
```

æµ‹è¯•å†…å®¹:
- âœ“ RCON è¿æ¥
- âœ“ WebSocket è¿æ¥
- âœ“ æ–­çº¿é‡è¿
- âœ“ MC æœåŠ¡å™¨è¿æ¥

#### è¿è¡Œæ§åˆ¶å°æµ‹è¯• (æ­¥éª¤ 55)

```bash
cd backend
npx ts-node test/test-console.ts
```

æµ‹è¯•å†…å®¹:
- âœ“ å‘½ä»¤å‘é€
- âœ“ å¤šä¸ªå‘½ä»¤
- âœ“ æ¶ˆæ¯ç±»å‹

#### è¿è¡Œä»ªè¡¨ç›˜æµ‹è¯• (æ­¥éª¤ 56)

```bash
cd backend
npx ts-node test/test-dashboard.ts
```

æµ‹è¯•å†…å®¹:
- âœ“ è·å–å½“å‰çŠ¶æ€
- âœ“ å®æ—¶çŠ¶æ€æ›´æ–°
- âœ“ æ•°æ®æœ‰æ•ˆæ€§
- âœ“ å¤šæœåŠ¡å™¨æ•°æ®

## ç†è§£æµ‹è¯•ç»“æœ

### æˆåŠŸçš„æµ‹è¯•è¾“å‡º

```
========================================

ğŸ“‹ è¿æ¥æµ‹è¯• ç»“æœ

========================================

âœ“ æµ‹è¯• RCON è¿æ¥
  æ¶ˆæ¯: RCON è¿æ¥æˆåŠŸ (å»¶è¿Ÿ: 45ms)
  è€—æ—¶: 234ms

âœ“ æµ‹è¯• WebSocket è¿æ¥
  æ¶ˆæ¯: WebSocket è¿æ¥æˆåŠŸ (Socket ID: abc123...)
  è€—æ—¶: 156ms

...

========================================
æ€»è®¡: 4 ä¸ªæµ‹è¯•
é€šè¿‡: 4 ä¸ª
å¤±è´¥: 0 ä¸ª
æ€»è€—æ—¶: 1234ms
========================================
```

### å¤±è´¥çš„æµ‹è¯•è¾“å‡º

```
âœ— æµ‹è¯• RCON è¿æ¥
  æ¶ˆæ¯: RCON è¿æ¥å¤±è´¥: Connection refused
  è€—æ—¶: 234ms
  é”™è¯¯: Connection refused
```

## æ•…éšœæ’æŸ¥

### è¿æ¥æµ‹è¯•å¤±è´¥

**é—®é¢˜: RCON è¿æ¥å¤±è´¥**
```
âœ— æµ‹è¯• RCON è¿æ¥
  æ¶ˆæ¯: RCON è¿æ¥å¤±è´¥: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨
```

**è§£å†³æ­¥éª¤:**
1. ç¡®ä¿ Minecraft æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ `server.properties` ä¸­ RCON å·²å¯ç”¨
3. éªŒè¯ RCON ç«¯å£ (é»˜è®¤ 25575) æ­£ç¡®
4. æ£€æŸ¥å¯†ç æ˜¯å¦åŒ¹é…
5. ç¡®è®¤é˜²ç«å¢™å…è®¸ RCON ç«¯å£

```bash
# Linux/Mac: æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -an | grep 25575

# Windows: æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -ano | findstr :25575
```

**é—®é¢˜: WebSocket è¿æ¥å¤±è´¥**
```
âœ— æµ‹è¯• WebSocket è¿æ¥
  æ¶ˆæ¯: WebSocket è¿æ¥å¤±è´¥: Connection refused
```

**è§£å†³æ­¥éª¤:**
1. ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (`npm run dev`)
2. æ£€æŸ¥åç«¯æ—¥å¿—ä¸­çš„é”™è¯¯
3. éªŒè¯ç«¯å£ 3001 æ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹å ç”¨
4. æ£€æŸ¥é˜²ç«å¢™é…ç½®

### æ§åˆ¶å°æµ‹è¯•å¤±è´¥

**é—®é¢˜: å‘½ä»¤å‘é€å¤±è´¥**
```
âœ— æµ‹è¯•å‘½ä»¤å‘é€
  æ¶ˆæ¯: å‘½ä»¤å‘é€å¤±è´¥: timeout
```

**è§£å†³æ­¥éª¤:**
1. æ£€æŸ¥ RCON è¿æ¥æ˜¯å¦æ­£å¸¸
2. éªŒè¯ MC æœåŠ¡å™¨æ˜¯å¦å“åº”
3. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯
4. å°è¯•æ‰‹åŠ¨å‘é€å‘½ä»¤æµ‹è¯•

### ä»ªè¡¨ç›˜æµ‹è¯•å¤±è´¥

**é—®é¢˜: æ— æ³•è·å–çŠ¶æ€**
```
âœ— æµ‹è¯•è·å–å½“å‰çŠ¶æ€
  æ¶ˆæ¯: è·å–çŠ¶æ€è¶…æ—¶
  é”™è¯¯: 10ç§’å†…æœªæ”¶åˆ°å“åº”
```

**è§£å†³æ­¥éª¤:**
1. æ£€æŸ¥ Spark Mod æ˜¯å¦æ­£ç¡®å®‰è£…
2. éªŒè¯ Spark API ç«¯ç‚¹é…ç½®
3. æŸ¥çœ‹ MC æœåŠ¡å™¨æ—¥å¿—
4. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ Spark ç«¯å£

**é—®é¢˜: æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥å¤±è´¥**
```
âœ— æµ‹è¯•æ•°æ®æœ‰æ•ˆæ€§
  æ¶ˆæ¯: æ•°æ®éªŒè¯å¤±è´¥: TPS å€¼æ— æ•ˆ: -1
```

**è§£å†³æ­¥éª¤:**
1. æ£€æŸ¥æ•°æ®æ¥æº (RCON æˆ– Spark)
2. éªŒè¯æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
4. å°è¯•é‡å¯ Spark æˆ– MC æœåŠ¡å™¨

## æµ‹è¯•é…ç½®

### ä¿®æ”¹æµ‹è¯•è¶…æ—¶

å¦‚æœæµ‹è¯•ç»å¸¸è¶…æ—¶ï¼Œå¯ä»¥ä¿®æ”¹æµ‹è¯•æ–‡ä»¶ä¸­çš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œåœ¨ `test-connection.ts` ä¸­:

```typescript
// ä¿®æ”¹è¶…æ—¶æ—¶é—´ (é»˜è®¤ 5000ms)
const timeout = setTimeout(() => {
  // ...
}, 10000);  // æ”¹ä¸º 10 ç§’
```

### æµ‹è¯•å¤šä¸ªæœåŠ¡å™¨

å¦‚æœæ·»åŠ äº†å¤šä¸ªæœåŠ¡å™¨é…ç½®ï¼Œä»ªè¡¨ç›˜æµ‹è¯•ä¼šè‡ªåŠ¨æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨ã€‚

è¦æ·»åŠ æµ‹è¯•é…ç½®:

```bash
# æ·»åŠ ç¬¬äºŒä¸ªé…ç½®
curl -X POST http://localhost:3001/api/configs \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ç¬¬äºŒä¸ªæœåŠ¡å™¨",
    "host": "192.168.1.100",
    "port": 25575,
    "password": "password2"
  }' -UseBasicParsing
```

## æµ‹è¯•è¦†ç›–èŒƒå›´

### æ­¥éª¤ 54: è¿æ¥æµ‹è¯•

| æµ‹è¯•é¡¹ | è¦†ç›–èŒƒå›´ |
|--------|---------|
| RCON è¿æ¥ | éªŒè¯ä¸ MC æœåŠ¡å™¨çš„ RCON è¿æ¥ |
| WebSocket è¿æ¥ | éªŒè¯ä¸åç«¯çš„ WebSocket è¿æ¥ |
| æ–­çº¿é‡è¿ | æ¨¡æ‹Ÿæ–­å¼€è¿æ¥åçš„è‡ªåŠ¨é‡è¿ |
| MC æœåŠ¡å™¨è¿æ¥ | éªŒè¯é€šè¿‡ WebSocket è¿æ¥ MC æœåŠ¡å™¨ |

### æ­¥éª¤ 55: æ§åˆ¶å°æµ‹è¯•

| æµ‹è¯•é¡¹ | è¦†ç›–èŒƒå›´ |
|--------|---------|
| å‘½ä»¤å‘é€ | å‘é€å•ä¸ªå‘½ä»¤å¹¶æ¥æ”¶å“åº” |
| å¤šä¸ªå‘½ä»¤ | å¿«é€Ÿå‘é€å¤šä¸ªå‘½ä»¤ |
| æ¶ˆæ¯ç±»å‹ | éªŒè¯ä¸åŒç±»å‹çš„æ§åˆ¶å°æ¶ˆæ¯ |

### æ­¥éª¤ 56: ä»ªè¡¨ç›˜æµ‹è¯•

| æµ‹è¯•é¡¹ | è¦†ç›–èŒƒå›´ |
|--------|---------|
| è·å–å½“å‰çŠ¶æ€ | ä¸€æ¬¡æ€§è·å–æœåŠ¡å™¨çŠ¶æ€å¿«ç…§ |
| å®æ—¶çŠ¶æ€æ›´æ–° | æ¥æ”¶è‡³å°‘ 3 ä¸ªå®æ—¶çŠ¶æ€æ›´æ–° |
| æ•°æ®æœ‰æ•ˆæ€§ | éªŒè¯æ•°æ®èŒƒå›´å’Œæ ¼å¼ |
| å¤šæœåŠ¡å™¨æ•°æ® | æµ‹è¯•å¤šä¸ªæœåŠ¡å™¨çš„æ•°æ®è·å– |

## è‡ªåŠ¨åŒ–æµ‹è¯•

### é›†æˆ CI/CD

å¯ä»¥åœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨è¿è¡Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œåœ¨ GitHub Actions ä¸­:

```yaml
# .github/workflows/test.yml
name: Functional Tests

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 18
      - run: cd backend && npm install
      - run: npm run build
      - run: npm run dev &
      - run: npm run test:functional
```

### æœ¬åœ°æµ‹è¯•è„šæœ¬

åˆ›å»º `test.sh` è¿›è¡Œæœ¬åœ°è‡ªåŠ¨åŒ–æµ‹è¯•:

```bash
#!/bin/bash

echo "å¯åŠ¨åç«¯æœåŠ¡..."
cd backend
npm run dev &
BACKEND_PID=$!

# ç­‰å¾…åç«¯å¯åŠ¨
sleep 3

echo "è¿è¡ŒåŠŸèƒ½æµ‹è¯•..."
npm run test:functional

# è·å–æµ‹è¯•ç»“æœ
TEST_RESULT=$?

# åœæ­¢åç«¯
kill $BACKEND_PID

exit $TEST_RESULT
```

è¿è¡Œè„šæœ¬:
```bash
chmod +x test.sh
./test.sh
```

## æ‰©å±•æµ‹è¯•

### æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•

åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶ `backend/test/test-custom.ts`:

```typescript
import { createLogger } from '../src/utils/logger';

const logger = createLogger('CustomTests');

class CustomTestSuite {
  async runAll() {
    // å®ç°è‡ªå®šä¹‰æµ‹è¯•
  }
}

export { CustomTestSuite };
```

## æ€§èƒ½åŸºå‡†

é¢„æœŸçš„æµ‹è¯•è¿è¡Œæ—¶é—´:

| æµ‹è¯•å¥—ä»¶ | é¢„æœŸè€—æ—¶ |
|---------|---------|
| è¿æ¥æµ‹è¯• | 5-10 ç§’ |
| æ§åˆ¶å°æµ‹è¯• | 15-20 ç§’ |
| ä»ªè¡¨ç›˜æµ‹è¯• | 15-20 ç§’ |
| **æ€»è®¡** | **35-50 ç§’** |

å¦‚æœæµ‹è¯•è¿è¡Œæ—¶é—´è¶…è¿‡é¢„æœŸï¼Œå¯èƒ½è¡¨ç¤ºç½‘ç»œå»¶è¿Ÿæˆ–æœåŠ¡å™¨å“åº”ç¼“æ…¢ã€‚

## ä¸‹ä¸€æ­¥

âœ… åŠŸèƒ½æµ‹è¯•å®Œæˆåï¼Œè¿›è¡Œä»¥ä¸‹æ“ä½œ:

1. é›†æˆåˆ° CI/CD æµç¨‹
2. è®¾ç½®è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Š
3. ä¼˜åŒ–æ€§èƒ½ (æ­¥éª¤ 57-59)
4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹æµ‹è¯•è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥åç«¯æ—¥å¿—: `backend/logs/`
3. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£: `backend/backend-integration.md`
4. æ£€æŸ¥ Minecraft æœåŠ¡å™¨æ—¥å¿—

---

**å½“å‰è¿›åº¦:** æ­¥éª¤ 54-56 åŠŸèƒ½æµ‹è¯• âœ… å®Œæˆ
